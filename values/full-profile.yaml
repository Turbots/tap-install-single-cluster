#@ load("@ytt:data", "data")
---
excluded_packages:
- policy.apps.tanzu.vmware.com
- cert-manager.tanzu.vmware.com
- contour.tanzu.vmware.com

profile: full
ceip_policy_disclosed: true # Installation fails if this is set to 'false'

shared:
  ingress_domain: #@ data.values.tap.ingress.domain

cnrs:
  domain_name: #@ "{}".format(data.values.tap.ingress.domain)
  domain_template: "{{.Name}}.{{.Domain}}"

buildservice:
  tanzunet_username: #@ data.values.tap.registry.username
  tanzunet_password: #@ data.values.tap.registry.password
  enable_automatic_dependency_updates: true
  descriptor_name: full
  kp_default_repository: #@ "{}/{}/build-service".format(data.values.tap.developer.registry.hostname,data.values.tap.developer.registry.project)
  kp_default_repository_username: #@ data.values.tap.developer.registry.username
  kp_default_repository_password: #@ data.values.tap.developer.registry.password

supply_chain: testing_scanning

ootb_supply_chain_testing_scanning:
  registry:
    server: #@ data.values.tap.developer.registry.hostname
    repository: #@ data.values.tap.developer.registry.project
  gitops:
    ssh_secret: "git-secret"
    server_address: #@ data.values.gitops_repository.server_address
    repository_owner: #@ data.values.gitops_repository.owner
    repository_name: gitops
    branch: main
    commit_strategy: pull_request
    pull_request:
      commit_branch: ""
      server_kind: #@ data.values.gitops_repository.type
      pull_request_title: Change ready for review
      pull_request_body: Generated by the TAP supply chain

metadata_store:
  ns_for_export_app_cert: #@ data.values.tap.developer.namespace
  ingress_enabled: false
  app_service_type: ClusterIP

grype:
  namespace: #@ data.values.tap.developer.namespace
  targetImagePullSecret: dev-registry

tap_gui:
  service_type: ClusterIP # NodePort for distributions that don't support LoadBalancer
  tls:
    namespace: tap-install
    secretName: tap-gui-tls
  app_config: 
    auth:
      environment: development
      providers:
        github:
          development:
            clientId: 'cd8fa4c204b15976649f'
            clientSecret: 'e7d1184affa99f42b93940cbdb0debdc5a171245'
    organization:
      name: 'TAXUD Dev Center'
    customize:
      custom_name: 'TAXUD Dev Center'
    backend:
      baseUrl: #@ "https://tap-gui.{}".format(data.values.tap.ingress.domain)
      cors:
        origin: #@ "https://tap-gui.{}".format(data.values.tap.ingress.domain)
      reading:
        allow:
          - host: #@ "*.{}".format(data.values.tap.ingress.domain)
    app:
      baseUrl: #@ "https://tap-gui.{}".format(data.values.tap.ingress.domain)
      title: 'TAXUD Dev Center'
    catalog:
      locations:
        - type: url
          target: https://github.com/Turbots/tap-config/blob/main/catalog-info.yaml

contour:
  envoy:
    service:
      type: LoadBalancer

accelerator: 
  domain: #@ "{}".format(data.values.tap.ingress.domain)
  ingress:
    include: true
  tls:
    namespace: #@ data.values.tap.ingress.tls_namespace
    secretName: #@ data.values.tap.ingress.tls_secret
  server:
    service_type: ClusterIP